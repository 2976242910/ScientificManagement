<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.hospital301.scientificmanagement.dao.scientificpayoffs.report.ReportMapper">
	<!-- 获取我的成果中的奖励统计结果 -->
	<resultMap id="project" type="java.util.Map">
		<result column="p.label" property="name"></result>
		<result column="count(1)" property="value"></result>
	</resultMap>
	<select id="getReportReward" resultMap="project" parameterType="java.util.Map">
		select p.label as name, count(1) as value from
		project_member m,
		project_reward b
		left join parameter_value p on
		b.level=p.value and
		p.parameter='rewardLevel'
		where 1=1
		<if test="username != null "> and m.username=#{username} </if>
		and m.reference_id=b.id and m.type='reward' group by
		b.level order by
		p.order;
	</select>

	<!-- 获取我的成果中的论文统计结果 -->
	<select id="getReportPaper" resultMap="project" parameterType="java.util.Map">
		select p.label as name, count(1) as value from
		project_member m,
		project_paper b
		left join parameter_value p on
		b.type=p.value and
		p.parameter='paperType'
		where 1=1
		<if test=" username != null "> and m.username=#{username} </if>
		and m.reference_id=b.id and m.type='paper' group by b.type
		order by
		p.order
	</select>

	<!-- 获取我的成果中的软著的统计结果 -->
	<select id="getReportSoftWare" resultMap="project"
		parameterType="java.util.Map">
		select p.label as name,
		count(1) as value from
		project_member m,
		project_software b
		left join
		parameter_value p on
		b.development_mode=p.value and
		p.parameter='softwareDevelopmentType'
		where 1=1
		<if test="username != null "> and m.username= #{username} </if>
		and m.reference_id=b.id and
		m.type='software'
		group by
		b.development_mode order by p.order
	</select>


	<!-- 获取我的成果中的著作的统计结果 -->
	<select id="getReportWork" resultMap="project" parameterType="java.util.Map">
		select p.label as name, count(1) as value from
		project_member m,
		project_work b
		left join parameter_value p on
		b.category=p.value and
		p.parameter='workCategoryType'
		where 1=1
		<if test=" username != null "> and m.username=#{username} </if>
		and m.reference_id=b.id and m.type='work' group
		by b.category order by
		p.order
	</select>

	<!-- 获取我的成果中patent统计结果 -->
	<select id="getReportPatent" resultMap="project" parameterType="java.util.Map">
		select p.label as name, count(1) as value from
		project_member m,
		project_patent b
		left join parameter_value p on
		b.type=p.value and
		p.parameter='patentType'
		where 1=1
		and m.reference_id=b.id and
		m.type='patent'
		<if test="username != null "> and m.username=#{username} </if>
		group by b.type
		order by p.order
	</select>

	<!-- 获取我的项目的统计结果 -->
	<resultMap id="projectMap" type="java.util.Map">
		<result column="p.level" property="level"></result>
		<result column="count(1)" property="count"></result>
	</resultMap>
	<select id="getReportProject" resultMap="projectMap"
		parameterType="java.util.Map">
		select p.level level, count(1) count from project_member m,
		project p
		where
		m.reference_id=p.id and
		m.type='project'
		<if test="username!=null"> and m.username=#{username} </if>
		group by p.level
	</select>

	<!-- 获取实验室的统计结果 -->
	<resultMap id="labReport" type="java.util.Map">
		<result column="p.category" property="category"></result>
		<result column="count(1)" property="count"></result>
	</resultMap>
	<select id="getReportLab" resultMap="labReport" parameterType="java.util.Map">
		select p.category category, count(1) count from project_member m,
		project_lab p
		where 1=1
		<if test="username != null"> m.username=#{username} </if>
		and m.reference_id=p.id and m.type='lab'
		group by p.category
	</select>


	<!-- 获取学术任职的统计结果 -->
	<resultMap id="academyReport" type="java.util.Map">
		<result column="a.academy_level" property="academy_level"></result>
		<result column="count(1)" property="count"></result>
	</resultMap>
	<select id="getReportAcademy" resultMap="academyReport"
		parameterType="java.util.Map">
		select a.academy_level academy_level , count(1) count from
		project_academy a,
		project_academy_post p
		where a.id = p.academy_id and
		<if test="username != null"> p.username=#{username} </if>
		group by a.academy_level
	</select>

	<!-- 获取学术活动的统计结果 -->
	<resultMap id="exchangeReport" type="java.util.Map">
		<result column="p.type" property="type"></result>
		<result column="count(1)" property="count"></result>
	</resultMap>
	<select id="getReportExchange" resultMap="exchangeReport"
		parameterType="java.util.Map">
		select p.type type , count(1) count from project_member m,
		project_exchange p
		where 1=1
		<if test="username != null"> and m.username=#{username} </if>
		and m.reference_id=p.id and m.type='exchange'
		group by p.type
	</select>

	<!-- 个人主页上的统计信息 -->
	<resultMap id="userReport" type="java.util.Map">
		<result column="username" property="username"></result>
		<result column="type" property="type"></result>
		<result column="count(1)" property="count"></result>
	</resultMap>
	<select id="getUserReport" resultMap="userReport" parameterType="java.util.Map">
		select username,type,count(1) count from project_member where
		deleted=0
		<if test="username != null"> and username=#{username} </if>
		group by type
		<!-- "select `type` as `type`, count(1) as `count` from project_member 
			where 1=1 <if test="username != null"> and username=#{username} </if> and 
			deleted= 1 group by type -->
	</select>
</mapper>